<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Importu PRO</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #000;
            color: #fff;
            font-size: 13px;
            line-height: 1.3;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0.75rem;
        }

        header {
            text-align: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #333;
            margin-bottom: 0.75rem;
        }

        h1 {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #007aff, #34c759);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.25rem;
        }

        .mode-toggle {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .mode-btn {
            padding: 0.5rem 1.25rem;
            border: 1px solid #333;
            border-radius: 6px;
            background: #1c1c1e;
            color: #888;
            font-size: 0.8125rem;
            font-weight: 600;
            cursor: pointer;
        }

        .mode-btn.active {
            border-color: #007aff;
            background: #007aff;
            color: white;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* COMPACT GRID */
        .compact-grid {
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 0.75rem;
        }

        @media (max-width: 1200px) {
            .compact-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: #1c1c1e;
            border-radius: 8px;
            padding: 0.75rem;
            border: 1px solid #333;
        }

        .card-title {
            font-size: 0.875rem;
            font-weight: 700;
            color: #007aff;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        label {
            display: block;
            font-size: 0.6875rem;
            color: #888;
            font-weight: 600;
            margin-bottom: 0.25rem;
            text-transform: uppercase;
        }

        input, select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #333;
            border-radius: 4px;
            background: #2c2c2e;
            color: #fff;
            font-size: 0.8125rem;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #007aff;
        }

        .btn {
            width: 100%;
            padding: 0.625rem;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 700;
            cursor: pointer;
            margin-top: 0.5rem;
        }

        .btn-primary {
            background: #007aff;
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
        }

        /* RESULTS - ULTRA COMPACT */
        .results-compact {
            display: grid;
            gap: 0.5rem;
        }

        .mini-card {
            background: #2c2c2e;
            border-radius: 6px;
            padding: 0.5rem;
        }

        .mini-label {
            font-size: 0.625rem;
            color: #888;
            text-transform: uppercase;
            margin-bottom: 0.25rem;
        }

        .mini-value {
            font-size: 0.875rem;
            font-weight: 700;
            color: #007aff;
        }

        table {
            width: 100%;
            font-size: 0.75rem;
        }

        table td {
            padding: 0.375rem 0;
            border-bottom: 1px solid #2c2c2e;
        }

        table td:first-child {
            color: #888;
        }

        table td:last-child {
            text-align: right;
            font-weight: 600;
        }

        .total-row td {
            border-top: 2px solid #007aff;
            padding-top: 0.5rem;
            font-weight: 700;
            font-size: 0.875rem;
        }

        .total-row td:last-child {
            color: #007aff;
            font-size: 1.125rem;
        }

        /* AI SECTION */
        .upload-zone {
            background: #1c1c1e;
            border: 2px dashed #007aff;
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            margin-bottom: 0.75rem;
        }

        .upload-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .thumbnails {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .thumbnail {
            position: relative;
            aspect-ratio: 1;
            border-radius: 6px;
            overflow: hidden;
            background: #2c2c2e;
            border: 1px solid #333;
        }

        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .thumbnail-remove {
            position: absolute;
            top: 0.25rem;
            right: 0.25rem;
            background: #ff3b30;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 14px;
            cursor: pointer;
        }

        .analyzing {
            background: #1c1c1e;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            display: none;
        }

        .analyzing.show {
            display: block;
        }

        .spinner {
            border: 3px solid #2c2c2e;
            border-top: 3px solid #007aff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ANALYSIS RESULTS - COMPACT */
        .analysis-grid {
            display: grid;
            grid-template-columns: 420px 1fr;
            gap: 0.75rem;
        }

        @media (max-width: 1400px) {
            .analysis-grid {
                grid-template-columns: 1fr;
            }
        }

        .recommendation {
            background: linear-gradient(135deg, rgba(52, 199, 89, 0.15), rgba(52, 199, 89, 0.05));
            border: 1px solid #34c759;
            border-radius: 6px;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .recommendation-title {
            font-size: 0.625rem;
            color: #34c759;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 0.375rem;
        }

        .recommendation-text {
            font-size: 0.8125rem;
            line-height: 1.4;
        }

        .price-box {
            text-align: center;
            background: #1c1c1e;
            border-radius: 6px;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .price-label {
            font-size: 0.625rem;
            color: #888;
            text-transform: uppercase;
            margin-bottom: 0.25rem;
        }

        .price-value {
            font-size: 1.75rem;
            font-weight: 900;
            color: #34c759;
            margin-bottom: 0.375rem;
        }

        .profit-badge {
            display: inline-block;
            background: rgba(52, 199, 89, 0.2);
            color: #34c759;
            padding: 0.375rem 0.75rem;
            border-radius: 12px;
            font-weight: 700;
            font-size: 0.75rem;
        }

        .section-mini {
            margin-bottom: 0.75rem;
        }

        .section-mini-title {
            font-size: 0.75rem;
            font-weight: 700;
            color: #007aff;
            margin-bottom: 0.375rem;
            text-transform: uppercase;
        }

        .section-mini-content {
            font-size: 0.75rem;
            line-height: 1.5;
        }

        .list-compact {
            list-style: none;
            padding: 0;
        }

        .list-compact li {
            padding: 0.25rem 0;
            padding-left: 1rem;
            position: relative;
            font-size: 0.75rem;
        }

        .list-compact li::before {
            content: '‚Ä¢';
            position: absolute;
            left: 0.25rem;
            color: #007aff;
        }

        .strategy-mini {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }

        .strategy-mini-card {
            background: #2c2c2e;
            border-radius: 6px;
            padding: 0.625rem;
        }

        .strategy-mini-title {
            font-size: 0.625rem;
            color: #007aff;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 0.375rem;
        }

        .strategy-mini-content {
            font-size: 0.6875rem;
            line-height: 1.4;
            color: #ccc;
        }

        .hidden {
            display: none;
        }

        .api-input {
            width: 100%;
            padding: 0.5rem;
            background: #2c2c2e;
            border: 1px solid #333;
            border-radius: 6px;
            color: #fff;
            font-family: monospace;
            font-size: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .api-label {
            font-size: 0.6875rem;
            color: #888;
            font-weight: 600;
            margin-bottom: 0.375rem;
            text-transform: uppercase;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöó Kalkulator Importu PRO</h1>
        </header>

        <div class="mode-toggle">
            <button class="mode-btn active" data-mode="simple">üßÆ Prosty</button>
            <button class="mode-btn" data-mode="ai">ü§ñ AI Analiza</button>
        </div>

        <!-- SIMPLE CALCULATOR -->
        <div class="section active" id="simpleSection">
            <div class="compact-grid">
                <div class="card">
                    <div class="card-title">üìù Dane</div>
                    <form id="simpleForm">
                        <div class="form-row">
                            <div>
                                <label>Koszt (EUR)</label>
                                <input type="number" id="sCost" step="0.01" required>
                            </div>
                            <div>
                                <label>Transport (EUR)</label>
                                <input type="number" id="sTransport" step="0.01" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div>
                                <label>Kraj</label>
                                <select id="sCountry" required>
                                    <option value="">‚Äî</option>
                                    <option value="AT|468">Austria</option>
                                    <option value="BE|448">Belgia</option>
                                    <option value="DE|448">Niemcy</option>
                                    <option value="IT|628">W≈Çochy</option>
                                </select>
                            </div>
                            <div>
                                <label>Silnik (ccm)</label>
                                <input type="number" id="sEngine" step="1">
                            </div>
                        </div>
                        <div>
                            <label>Kurs EUR/PLN</label>
                            <input type="number" id="sRate" value="4.22" step="0.0001" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Oblicz</button>
                    </form>
                </div>

                <div class="card">
                    <div class="card-title">üí∞ Koszty</div>
                    <table id="sResults">
                        <tr><td>Pojazd</td><td id="sResCar">‚Äî</td></tr>
                        <tr><td>Transport</td><td id="sResTransport">‚Äî</td></tr>
                        <tr><td>Dokumenty</td><td id="sResDocs">‚Äî</td></tr>
                        <tr><td>Akcyza</td><td id="sResExcise">‚Äî</td></tr>
                        <tr><td>Dodatkowe</td><td id="sResAdd">‚Äî</td></tr>
                        <tr class="total-row"><td>RAZEM</td><td id="sResTotal">‚Äî</td></tr>
                    </table>
                </div>
            </div>
        </div>

        <!-- AI SECTION -->
        <div class="section" id="aiSection">
            <div class="api-label">üîë Klucz API OpenAI</div>
            <input type="password" id="apiKey" class="api-input" placeholder="sk-proj-...">

            <div class="upload-zone" id="uploadZone">
                <div class="upload-icon">üì∏</div>
                <div style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.25rem;">Dodaj zdjƒôcia AUTO1</div>
                <div style="font-size: 0.6875rem; color: #888;">Kliknij lub przeciƒÖgnij</div>
                <input type="file" id="imageInput" accept="image/*" multiple class="hidden">
            </div>

            <div class="thumbnails" id="thumbnails"></div>

            <button class="btn btn-primary" id="analyzeBtn" disabled>ü§ñ Analizuj (AI)</button>

            <div class="analyzing" id="analyzing">
                <div class="spinner"></div>
                <div style="color: #888;">Analizujƒô...</div>
            </div>

            <!-- RESULTS -->
            <div id="aiResults" style="display:none; margin-top: 0.75rem;">
                <div class="analysis-grid">
                    <!-- LEFT -->
                    <div>
                        <div class="card" style="margin-bottom: 0.75rem;">
                            <div class="card-title">üí∞ Koszty</div>
                            <table>
                                <tr><td>Pojazd</td><td id="aCar">‚Äî</td></tr>
                                <tr><td>Transport</td><td id="aTransport">‚Äî</td></tr>
                                <tr><td>Dokumenty</td><td id="aDocs">‚Äî</td></tr>
                                <tr><td>Akcyza</td><td id="aExcise">‚Äî</td></tr>
                                <tr><td>Dodatkowe</td><td id="aAdd">‚Äî</td></tr>
                                <tr class="total-row"><td>ALL-IN</td><td id="aTotal">‚Äî</td></tr>
                            </table>
                        </div>

                        <div class="card">
                            <div class="card-title">üöó Pojazd</div>
                            <div class="mini-card" style="margin-bottom: 0.5rem;">
                                <div class="mini-label">Model</div>
                                <div class="mini-value" id="aModel" style="font-size: 0.8125rem;">‚Äî</div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.5rem;">
                                <div class="mini-card">
                                    <div class="mini-label">Rok</div>
                                    <div class="mini-value" id="aYear">‚Äî</div>
                                </div>
                                <div class="mini-card">
                                    <div class="mini-label">Przebieg</div>
                                    <div class="mini-value" id="aMileage" style="font-size: 0.6875rem;">‚Äî</div>
                                </div>
                                <div class="mini-card">
                                    <div class="mini-label">Silnik</div>
                                    <div class="mini-value" id="aEngine">‚Äî</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- RIGHT -->
                    <div>
                        <div class="recommendation">
                            <div class="recommendation-title">üí° Werdykt</div>
                            <div class="recommendation-text" id="aVerdict">‚Äî</div>
                        </div>

                        <div class="price-box">
                            <div class="price-label">Prognoza sprzeda≈ºy</div>
                            <div class="price-value" id="aPrice">‚Äî</div>
                            <div class="profit-badge" id="aProfit">‚Äî</div>
                        </div>

                        <div class="card" style="margin-bottom: 0.75rem;">
                            <div class="section-mini">
                                <div class="section-mini-title">üíµ Max cena zakupu</div>
                                <div class="section-mini-content" id="aMaxPrice">‚Äî</div>
                            </div>

                            <div class="section-mini">
                                <div class="section-mini-title">‚è±Ô∏è Rotacja</div>
                                <div class="section-mini-content" id="aTurnover">‚Äî</div>
                            </div>

                            <div class="section-mini">
                                <div class="section-mini-title">‚úÖ Plusy</div>
                                <ul class="list-compact" id="aPros">
                                    <li>‚Äî</li>
                                </ul>
                            </div>

                            <div class="section-mini">
                                <div class="section-mini-title">‚ö†Ô∏è Ryzyka</div>
                                <ul class="list-compact" id="aCons">
                                    <li>‚Äî</li>
                                </ul>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-title">üéØ Strategia</div>
                            <div class="strategy-mini" id="aStrategy"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Mode switching
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                document.getElementById(btn.dataset.mode === 'simple' ? 'simpleSection' : 'aiSection').classList.add('active');
            });
        });

        // Simple calculator
        document.getElementById('simpleForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const cost = parseFloat(document.getElementById('sCost').value) || 0;
            const transport = parseFloat(document.getElementById('sTransport').value) || 0;
            const docs = parseFloat(document.getElementById('sCountry').value.split('|')[1]) || 0;
            const engine = parseInt(document.getElementById('sEngine').value) || 0;
            const rate = parseFloat(document.getElementById('sRate').value) || 4.22;
            
            const exciseRate = engine > 0 ? (engine <= 1999 ? 0.031 : 0.186) : 0.031;
            
            const costPLN = cost * rate;
            const transportPLN = transport * rate;
            const docsPLN = docs * rate;
            const excisePLN = costPLN * exciseRate;
            const additionalPLN = 660;
            const total = costPLN + transportPLN + docsPLN + excisePLN + additionalPLN;
            
            document.getElementById('sResCar').textContent = fmt(costPLN);
            document.getElementById('sResTransport').textContent = fmt(transportPLN);
            document.getElementById('sResDocs').textContent = fmt(docsPLN);
            document.getElementById('sResExcise').textContent = fmt(excisePLN);
            document.getElementById('sResAdd').textContent = fmt(additionalPLN);
            document.getElementById('sResTotal').textContent = fmt(total);
        });

        function fmt(v) {
            return new Intl.NumberFormat('pl-PL', {maximumFractionDigits: 0}).format(v) + ' PLN';
        }

        // AI Section
        const savedKey = localStorage.getItem('openai_api_key');
        if (savedKey) document.getElementById('apiKey').value = savedKey;

        document.getElementById('apiKey').addEventListener('change', (e) => {
            localStorage.setItem('openai_api_key', e.target.value);
            updateBtn();
        });

        let images = [];
        const uploadZone = document.getElementById('uploadZone');
        const imageInput = document.getElementById('imageInput');
        const thumbnails = document.getElementById('thumbnails');
        const analyzeBtn = document.getElementById('analyzeBtn');

        uploadZone.addEventListener('click', () => imageInput.click());
        uploadZone.addEventListener('dragover', (e) => e.preventDefault());
        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            handleFiles(Array.from(e.dataTransfer.files).filter(f => f.type.startsWith('image/')));
        });
        imageInput.addEventListener('change', (e) => handleFiles(Array.from(e.target.files)));

        async function handleFiles(files) {
            for (const file of files) {
                const base64 = await toBase64(file);
                const dataUrl = await toDataUrl(file);
                images.push({ file, base64, dataUrl });
            }
            updateThumbnails();
            updateBtn();
        }

        function toBase64(file) {
            return new Promise(r => {
                const reader = new FileReader();
                reader.onload = () => r(reader.result.split(',')[1]);
                reader.readAsDataURL(file);
            });
        }

        function toDataUrl(file) {
            return new Promise(r => {
                const reader = new FileReader();
                reader.onload = () => r(reader.result);
                reader.readAsDataURL(file);
            });
        }

        function updateThumbnails() {
            thumbnails.innerHTML = '';
            images.forEach((img, i) => {
                const div = document.createElement('div');
                div.className = 'thumbnail';
                div.innerHTML = `<img src="${img.dataUrl}"><button class="thumbnail-remove" onclick="removeImg(${i})">√ó</button>`;
                thumbnails.appendChild(div);
            });
        }

        window.removeImg = function(i) {
            images.splice(i, 1);
            updateThumbnails();
            updateBtn();
        }

        function updateBtn() {
            analyzeBtn.disabled = !document.getElementById('apiKey').value || images.length === 0;
        }

        analyzeBtn.addEventListener('click', analyze);

        async function analyze() {
            const key = document.getElementById('apiKey').value;
            if (!key || !key.startsWith('sk-')) {
                alert('Wprowad≈∫ klucz API');
                return;
            }

            document.getElementById('analyzing').classList.add('show');
            document.getElementById('aiResults').style.display = 'none';

            try {
                const msgs = images.map(img => ({
                    type: 'image_url',
                    image_url: { url: `data:image/jpeg;base64,${img.base64}`, detail: 'high' }
                }));

                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${key}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o',
                        messages: [{
                            role: 'user',
                            content: [
                                ...msgs,
                                {
                                    type: 'text',
                                    text: document.getElementById('analysisPrompt').textContent
                                }
                            ]
                        }],
                        max_tokens: 3000,
                        temperature: 0.7,
                        response_format: { type: "json_object" }
                    })
                });

                if (!response.ok) {
                    const err = await response.json().catch(() => ({}));
                    throw new Error(err.error?.message || `API Error: ${response.status}`);
                }

                const data = await response.json();
                const result = JSON.parse(data.choices[0].message.content);
                displayResults(result);

            } catch (error) {
                alert('‚ùå B≈ÇƒÖd: ' + error.message);
            } finally {
                document.getElementById('analyzing').classList.remove('show');
            }
        }

        function displayResults(r) {
            const {vehicle, costs, marketAnalysis, verdict, salesStrategy} = r;

            document.getElementById('aModel').textContent = vehicle.model;
            document.getElementById('aYear').textContent = vehicle.year;
            document.getElementById('aMileage').textContent = vehicle.mileage.toLocaleString('pl-PL') + ' km';
            document.getElementById('aEngine').textContent = vehicle.engine + ' ccm';

            document.getElementById('aCar').textContent = fmt(costs.breakdown.vehicle);
            document.getElementById('aTransport').textContent = fmt(costs.breakdown.transport);
            document.getElementById('aDocs').textContent = fmt(costs.breakdown.documents);
            document.getElementById('aExcise').textContent = fmt(costs.breakdown.excise);
            document.getElementById('aAdd').textContent = fmt(costs.breakdown.additional);
            document.getElementById('aTotal').textContent = fmt(costs.totalPln);

            document.getElementById('aVerdict').textContent = `${verdict.decision} - ${verdict.reason}`;
            document.getElementById('aPrice').textContent = fmt(marketAnalysis.realSalePrice);
            document.getElementById('aProfit').innerHTML = `Zysk: ${fmt(verdict.profitPln)} (${verdict.profitPercent}%)`;
            document.getElementById('aMaxPrice').textContent = verdict.note || `Max ALL-IN: ${fmt(verdict.maxAllInPln)}`;
            document.getElementById('aTurnover').textContent = `${marketAnalysis.positioning} | Confidence: ${marketAnalysis.confidence}`;

            document.getElementById('aPros').innerHTML = vehicle.keyFeatures.map(p => `<li>${p}</li>`).join('');
            document.getElementById('aCons').innerHTML = marketAnalysis.risks.map(c => `<li>${c}</li>`).join('');

            document.getElementById('aStrategy').innerHTML = `
                <div class="strategy-mini-card">
                    <div class="strategy-mini-title">üíµ Cena</div>
                    <div class="strategy-mini-content">${salesStrategy.listingPrice}</div>
                </div>
                <div class="strategy-mini-card">
                    <div class="strategy-mini-title">üîß Poprawki</div>
                    <div class="strategy-mini-content">${salesStrategy.improvements}</div>
                </div>
                <div class="strategy-mini-card">
                    <div class="strategy-mini-title">üìù Marketing</div>
                    <div class="strategy-mini-content">${salesStrategy.marketingTips}</div>
                </div>
                <div class="strategy-mini-card">
                    <div class="strategy-mini-title">üë§ KupujƒÖcy</div>
                    <div class="strategy-mini-content">${salesStrategy.targetBuyer}</div>
                </div>
            `;

            document.getElementById('aiResults').style.display = 'block';
            document.getElementById('aiResults').scrollIntoView({ behavior: 'smooth' });
        }
    });
    </script>

    <!-- Hidden prompt template -->
    <div id="analysisPrompt" style="display:none;">ETAP 1: EKSTRAKCJA DANYCH ZE SCREENA AUTO1
Parsuj ze zdjƒôƒá AUTO1:
- auction_price_eur: Cena aukcji (EUR)
- transport_standard_eur: Transport STANDARD (EUR)
- last_registration_country: Kraj ostatniej rejestracji (np. IT, DE)
- vehicle_core: marka, model, generacja, rok, nadwozie, silnik (ccm/paliwo/moc), skrzynia, napƒôd, przebieg, VIN (je≈õli jest)
- equipment_text: pe≈Çna lista wyposa≈ºenia z screena
- condition_flags: uszkodzenia, naprawy, lakierowanie, b≈Çƒôdy (je≈õli widoczne)

ETAP 2: OBLICZENIA KOSZT√ìW (APLIKACJA)
Koszty wg cennika AUTO1 (2026):
- Dokumenty: DE/BE: 448 EUR, AT: 468 EUR, IT: 628 EUR, pozosta≈Çe sprawd≈∫ w tabeli
- Akcyza: ‚â§1999ccm: 3.1%, >1999ccm: 18.6%
- Kurs: 4.22 PLN/EUR
- Dodatkowe PL: 660 PLN (rejestracja + pranie + chemia)

Wz√≥r:
base_pln = (auction_price_eur + transport_eur) √ó 4.22
docs_pln = documents_eur √ó 4.22
excise_pln = base_pln √ó excise_rate
all_in_pln = base_pln + docs_pln + excise_pln + 660

ETAP 3: ANALIZA RYNKU (AI)
Teraz Ty przejmujesz:

1) IDENTYFIKACJA WERSJI/WYPOSA≈ªENIA
- Ustal trim (Comfort/Business/GT/Style/itp.) - pewny/niepewny
- Kluczowe opcje (+): automat, 4x4, LED, ACC, kamera, nawigacja, sk√≥ra, panorama, hak
- Deal-breakery (-): brak klimy, nietypowa konfiguracja

2) COMPS (POR√ìWNANIA PL)
- Zbierz 8-15 ofert z Otomoto/OLX: marka+model+generacja, rok ¬±1, silnik/moc, skrzynia, napƒôd
- Odrzuƒá skrajno≈õci (uszkodzone, bez op≈Çat, anomalie)
- Wybierz 5-8 najlepszych, policz medianƒô i rozrzut

3) CENA TRANSAKCYJNA REALNA
- Cena og≈Çosze≈Ñ ‚â† cena sprzeda≈ºy
- Korekty: przebieg, wyposa≈ºenie, stan, import
- Wynik: cena sprzeda≈ºy (PLN) + wide≈Çki (min-max) + pozycjonowanie

4) CONFIDENCE + RYZYKA
- Pewno≈õƒá: Wysokie/≈örednie/Niskie
- Czynniki obni≈ºajƒÖce pewno≈õƒá
- Ryzyka handlowe (popyt, typowe awarie jako czynnik negocjacji)

5) WERDYKT
profit_pln = sale_price_pln - all_in_pln
profit_percent = (profit_pln / all_in_pln) √ó 100

Mar≈ºa docelowa: 3500-4500 z≈Ç
Mar≈ºa min: 2500-3000 z≈Ç (tylko szybki obr√≥t ‚â§30 dni)

Werdykt:
- KUP: je≈õli profit ‚â• 3500 z≈Ç i brak czerwonych flag
- ODPU≈öƒÜ: je≈õli profit < 2500 z≈Ç lub wysokie ryzyko
- KUP DO CENY X: je≈õli profit za niski ‚Üí policz max_all_in_pln = sale_price_pln - 3500

FORMAT JSON:
{
  "vehicle": {
    "model": "Volkswagen Polo 1.4 FSI Comfortline",
    "year": 2009,
    "mileage": 224328,
    "engine": 1390,
    "priceEur": 1611,
    "transportEur": 454,
    "country": "IT",
    "trim": "Comfortline (pewny)",
    "keyFeatures": ["Klimatyzacja", "El. szyby", "ABS", "ESP"],
    "dealBreakers": []
  },
  "costs": {
    "totalPln": 11500,
    "breakdown": {
      "vehicle": 6798,
      "transport": 1916,
      "documents": 2648,
      "excise": 236,
      "additional": 660
    }
  },
  "marketAnalysis": {
    "compsCount": 8,
    "compsMedian": 13500,
    "compsRange": "12000-15000 PLN",
    "realSalePrice": 13000,
    "salePriceRange": "12500-13500 PLN",
    "positioning": "≈örodek rynku, negocjacja do 12000",
    "confidence": "≈örednie - wysoki przebieg, niepewna historia",
    "risks": [
      "Bardzo wysoki przebieg 224k km - utrudni sprzeda≈º",
      "Wiek 15 lat - mo≈ºliwe problemy techniczne",
      "Segment popularny ale przebieg odstrasza m≈Çodszych kupujƒÖcych"
    ]
  },
  "verdict": {
    "decision": "ODPU≈öƒÜ",
    "reason": "Mar≈ºa tylko 1500 z≈Ç (13%), poni≈ºej minimum 2500 z≈Ç. Wysoki przebieg = ryzyko d≈Çugiej sprzeda≈ºy.",
    "profitPln": 1500,
    "profitPercent": 13,
    "maxAllInPln": 9500,
    "note": "Aby osiƒÖgnƒÖƒá min 3500 z≈Ç mar≈ºy: max 9500 PLN all-in (obecnie 11500)"
  },
  "salesStrategy": {
    "listingPrice": "12800-13200 PLN, negocjacja 12000-12500",
    "improvements": "Pranie gruntowne, od≈õwie≈ºenie plastik√≥w, drobne poprawki",
    "marketingTips": "Podkre≈õl Comfortline, pe≈Çna dokumentacja IT, serwisowany",
    "targetBuyer": "Student/m≈Çoda osoba szukajƒÖca taniej jazdy, akceptuje wysoki przebieg"
  }
}

ZASADY:
- NIE zani≈ºaj ceny pod szybki obr√≥t - wyceniaj REALNIE
- Odrzucaj auta wymagajƒÖce napraw mechanicznych/lakierniczych (poza PDR/polerka)
- BƒÖd≈∫ konkretny i zgodny z rzeczywisto≈õciƒÖ rynku PL</div>
</body>
</html>
